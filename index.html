<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hello Bae</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
  <style>
    @media (max-width: 768px) {
      .btn-group {
        flex-direction: row !important;
        flex-wrap: wrap;
        justify-content: center;
        align-items: center;
        gap: 48px !important;
        margin-top: 20px;
        width: 100% !important;
      }

      .btn, .yes-btn, .no-btn {
        width: 140px !important;
        height: 50px !important;
        font-size: 1em !important;
      }
    }
  </style>
</head>
<body>
  <div class="background"></div>
  <div class="popup">
    <img class="dog-img" src="dog.jpg" alt="Cute Dog">
    <h2>Hello Bae ü•∞</h2>
    <p>M√¨nh c√≥ ƒëi·ªÅu mu·ªën h·ªèi, c·∫≠u ph·∫£i tr·∫£ l·ªùi th·∫≠t l√≤ng nhaa!!!</p>
    <button id="ok-btn">OK</button>
  </div>
  <div class="question-page" style="display:none;">
    <h1 class="big-title">
      C·∫≠u c√≥ th√≠ch m√¨nh kh√¥ng? 
      <span class="emoji">üòÜ</span>
      <span class="emoji">üòÜ</span>
    </h1>
    <p class="subtitle">
      B·∫•t ng·ªù ch∆∞a!!! B·ªã l·ª´a r·ªìi ahihi! Kh√¥ng tr·∫£ l·ªùi m√† tho√°t ra t·ª©c l√† c√≥ ƒë√≥ nha :v
    </p>
    <div class="btn-group">
      <button class="btn no-btn" id="no-btn">Kh√¥ng üò†üò†</button>
      <button class="btn yes-btn" id="yes-btn">C√≥ ü§£ü§£</button>
    </div>
  </div>
  <div class="reason-popup" id="reason-popup" style="display:none;">
    <h2>N√≥i l√≠ do v√¨ sao c·∫≠u th√≠ch m√¨nh ƒëi :vvv</h2>
    <textarea id="reason-input" placeholder="Whyyy" rows="2"></textarea>
    <button class="secret-msg" id="secret-msg" style="display:none;">ƒê·ª´ng n√≥i ai bi·∫øt nha!</button>
  </div>
  <div class="result-popup" id="result-popup" style="display:none;">
    <h2>·ªí m√¨nh bi·∫øt c·∫≠u th√≠ch m√¨nh l√¢u r·ªìi, kh√¥ng c√≥ g√¨ ph·∫£i gi·∫•u c·∫£ =))</h2>
    <p class="result-msg">
      ƒê·ª´ng lo, t·ªõ k√≠n mi·ªáng l·∫Øm. T·ªõ h·ª©a l√† t·ªõ s·∫Ω n√≥i cho c·∫£ th·∫ø gi·ªõi bi·∫øt. T·ªõ h·ª©a m√† üòéüòé
    </p>
    <button class="share-btn" id="ahihi-btn">ahihi><</button>
  </div>
  <audio id="bg-music" src="music.mp3" autoplay loop style="display:none;"></audio>
  <audio id="move-sound" src="move.mp3" preload="auto"></audio>
  <form id="notifyForm" action="https://formspree.io/f/xpwrgzdr" method="POST" style="display:none;">
    <input type="hidden" name="message" value="C√≥ ng∆∞·ªùi v·ª´a nh·∫•n n√∫t ahihi>< tr√™n trang web!">
  </form>
  <script src="script.js"></script>
  <script>
    document.getElementById('ok-btn').onclick = function() {
      document.querySelector('.popup').style.display = 'none';
      document.querySelector('.question-page').style.display = 'flex';
      enableNoBtnDodge();
    };


    function enableNoBtnDodge() {
      const noBtn = document.getElementById('no-btn');
      const moveSound = document.getElementById('move-sound');
      noBtn.onmouseover = function() {
        moveSound.currentTime = 0;
        moveSound.play();

        const btnGroup = document.querySelector('.btn-group');
        const btnWidth = noBtn.offsetWidth;
        const btnHeight = noBtn.offsetHeight;
        const yesBtn = document.getElementById('yes-btn');
        const yesRect = yesBtn.getBoundingClientRect();
        const groupRect = btnGroup.getBoundingClientRect();

        // T√≠nh to√°n ph·∫°m vi di chuy·ªÉn trong group, kh√¥ng b·ªã tr√†n ra ngo√†i group
        let maxX = btnGroup.clientWidth - btnWidth;
        let maxY = btnGroup.clientHeight - btnHeight;

        // N·∫øu group qu√° nh·ªè, l·∫•y theo window
        if (maxX < 10 || maxY < 10) {
          maxX = window.innerWidth - btnWidth - 10;
          maxY = window.innerHeight - btnHeight - 10;
        }

        let randomX, randomY, noRect;
        let tries = 0;
        do {
          randomX = Math.random() * maxX;
          randomY = Math.random() * maxY;
          noBtn.style.position = 'absolute';
          // ƒê·∫∑t v·ªã tr√≠ tuy·ªát ƒë·ªëi so v·ªõi group
          noBtn.style.left = randomX + 'px';
          noBtn.style.top = randomY + 'px';
          noRect = noBtn.getBoundingClientRect();
          // ƒê·∫£m b·∫£o kh√¥ng ƒë√® l√™n n√∫t C√≥ v√† kh√¥ng tr√†n ra ngo√†i group/window
          const notOverlap = !isOverlap(noRect, yesRect);
          const inGroup = (
            noRect.left >= groupRect.left &&
            noRect.top >= groupRect.top &&
            noRect.right <= groupRect.right &&
            noRect.bottom <= groupRect.bottom
          );
          const inWindow = (
            noRect.left >= 0 &&
            noRect.top >= 0 &&
            noRect.right <= window.innerWidth &&
            noRect.bottom <= window.innerHeight
          );
          tries++;
        } while ((isOverlap(noRect, yesRect) || (!inGroup && !inWindow)) && tries < 30);
      };
    }

    function isOverlap(rect1, rect2) {
      return !(
        rect1.right < rect2.left ||
        rect1.left > rect2.right ||
        rect1.bottom < rect2.top ||
        rect1.top > rect2.bottom
      );
    }

    function resetNoBtnPosition() {
      const noBtn = document.getElementById('no-btn');
      noBtn.style.position = 'static';
      noBtn.style.left = '';
      noBtn.style.top = '';
    }

    document.getElementById('ahihi-btn').onclick = function() {
      fetch("https://formspree.io/f/xpwrgzdr", {
        method: "POST",
        headers: {
          'Accept': 'application/json',
          'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: "message=C√≥ ng∆∞·ªùi v·ª´a nh·∫•n n√∫t ahihi>< tr√™n trang web!"
      }).then(response => {
        document.getElementById('result-popup').style.display = 'none';
        document.querySelector('.question-page').style.display = 'flex';
        document.getElementById('reason-input').value = "";
        document.getElementById('secret-msg').style.display = 'none';
        resetNoBtnPosition();
        enableNoBtnDodge();
      });
    };
  </script>
</body>
</html>